From ce6429982008e76776a401aa5225daf1274cbbec Mon Sep 17 00:00:00 2001
From: Simone Basso <bassosimone@gmail.com>
Date: Thu, 18 Oct 2012 09:08:34 +0200
Subject: [PATCH] Revert custom user: it's optional complexity

---
 M-Lab/install.sh       | 1 -
 Makefile               | 4 +---
 MasterSrv/install.sh   | 1 -
 neubot/system_posix.py | 8 +-------
 4 files changed, 2 insertions(+), 12 deletions(-)

diff --git a/M-Lab/install.sh b/M-Lab/install.sh
index e2517a5..a04b0b4 100755
--- a/M-Lab/install.sh
+++ b/M-Lab/install.sh
@@ -34,4 +34,3 @@ $DEBUG $INSTALL rsyncd.conf /etc/rsyncd.conf
 $DEBUG grep -q ^_neubot /etc/group || $DEBUG /usr/sbin/groupadd -r _neubot
 $DEBUG grep -q ^_neubot /etc/passwd || \
        $DEBUG /usr/sbin/useradd -r -d/ -g_neubot -s/sbin/nologin _neubot
-$DEBUG sed -i 's/@USER@/_neubot/g' $HOME/neubot/neubot/system_posix.py
diff --git a/Makefile b/Makefile
index 17ce1b3..51c8367 100644
--- a/Makefile
+++ b/Makefile
@@ -143,7 +143,6 @@ DATADIR ?= $(PREFIX)/share
 LOCALSTATEDIR ?= $(PREFIX)/var
 MANDIR ?= $(PREFIX)/share/man
 SYSCONFDIR ?= $(PREFIX)/etc
-USER ?= '_neubot'
 
 _install:
 	find . -type f -name .DS_Store -exec rm {} \;
@@ -191,8 +190,7 @@ _install:
 	$(INSTALL) -d $(DESTDIR)$(LOCALSTATEDIR)/neubot
 	for PATTERN in 's|@BINDIR@|$(BINDIR)|g' 's|@DATADIR@|$(DATADIR)|g' \
 	        's|@LOCALSTATEDIR@|$(LOCALSTATEDIR)|g' \
-	        's|@SYSCONFDIR@|$(SYSCONFDIR)|g' \
-	        's|@USER@|$(USER)|g'; do \
+	        's|@SYSCONFDIR@|$(SYSCONFDIR)|g'; do \
 	    ./scripts/sed_inplace $$PATTERN \
 	        $(DESTDIR)$(BINDIR)/neubot \
 	        $(DESTDIR)$(DATADIR)/applications/neubot.desktop \
diff --git a/MasterSrv/install.sh b/MasterSrv/install.sh
index 6c696d3..10ccd95 100755
--- a/MasterSrv/install.sh
+++ b/MasterSrv/install.sh
@@ -42,7 +42,6 @@ $DEBUG $INSTALL rc.local /etc/rc.local
 $DEBUG /bin/grep -q ^_neubot /etc/group || $DEBUG /usr/sbin/groupadd -r _neubot
 $DEBUG /bin/grep -q ^_neubot /etc/passwd || \
        $DEBUG /usr/sbin/useradd -r -d/ -g_neubot -s/sbin/nologin _neubot
-$DEBUG sed -i 's/@USER@/_neubot/g' /home/simone/neubot/neubot/system_posix.py
 $DEBUG $INSTALL -d /var/lib/neubot
 
 $DEBUG $INSTALL -d /usr/local/share/GeoIP
diff --git a/neubot/system_posix.py b/neubot/system_posix.py
index 6dcd48a..28aec29 100644
--- a/neubot/system_posix.py
+++ b/neubot/system_posix.py
@@ -32,13 +32,7 @@
 # the latter can.
 #
 
-#
-# By default use `nobody`, so it's possible to develop Neubot on UNIX systems
-# where the `_neubot` user does not exist.
-#
-USER = '@USER@'
-if USER.startswith('@'):
-    USER='nobody'
+USER = '_neubot'
 
 import pwd
 import os.path
-- 
1.7.12.1

